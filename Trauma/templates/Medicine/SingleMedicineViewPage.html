
{% extends 'Pharmacy/PharmacyBase.html' %}
{% load static %}
{% block title %}Medicines{% endblock title %}

{% block BaseCSS %}
<link rel="stylesheet" href="{% static 'assets/swiper/main_swiper.css' %}" />
<style>
      .change-location-popup-main-BG{
        background-color: rgba(0, 0, 0, 0.685);
        height: 100vh;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: -1;
        opacity: 0;
    }
    .change-location-popup{
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1;
    }
    .change-location-popup-main-BG-after{
        opacity: 1;
        z-index: 1000000;
      }
</style>

{% endblock BaseCSS %}

{% block pharmacy_body %}

<main class="px-4 sm:px-6 md:px-8 py-7">
      <section class="max-w-[1500px] mx-auto">
            <div class="text-gray-700 flex flex-wrap gap-2 mb-3 ml-5">
                  <a href='/' class="cursor-pointer outfit-font">Home</a> &gt; 
                  <span class="cursor-pointer outfit-font">Pharmacy</span> &gt; 
                  <span class="text-primary font-semibold cursor-pointer">{{product_main_category.name}}</span>
            </div>
            <div class="flex gap-7">
                  <div class="max-w-[410px] w-full">
                        <div class="relative overflow-hidden w-full h-[400px] border border-[#CACBE6] rounded-3xl flex justify-center">
                              <img src="{% if product.product_all_images.0.image %}{{product.product_all_images.0.image.url}}{% endif %}" class="max-w-full max-h-full" alt="">
                        </div>
                  </div>
                  <div class="flex-1 max-w-[600px]">
                        {% if product.prescription_required %}
                              <div class="flex items-center gap-3 w-full">
                                    <img class="size-7" src="{% static 'assets/Images/warning 1.png' %}" alt="">
                                    <p class="text-red-600 outfit-font text-[15px]">Prescription required for this product</p>
                              </div>
                        {% endif %}
                        <div class="">
                              <div class="flex items-start justify-between">
                                    <div>
                                          <h1 class="text-2xl mb-2 font-semibold text-[#151E2C] outfit-font">{{product.name}}</h1>
                                          <div class="flex gap-2.5">
                                                <span class="w-12 h-12 border border-gray-200 rounded-full bg-center bg-cover bg-no-repeat" style="background-image:url('{{product.store.profile_image}}')"></span>
                                                <span>
                                                      <p class="m-0 p-0 font-[400] text-[#0755E9]" style="margin:0;padding:0;font-size:16px">{{product.store.name}}</p>
                                                      <p class="m-0 p-0 text-sm font-[400] text-black flex gap-2 items-center" >
                                                            {{location.name}}
                                                            {% if location %}
                                                                  <span class='text-xs outfit-font text-[#0555E9] flex gap-1'>
                                                                        <span class="whitespace-nowrap text-[11px] outfit-font text-[#0555E9] flex items-center gap-1" showdistance="{{location.lat}},{{location.lng}}"></span>
                                                                  </span>
                                                            {% endif %}
                                                      </p>
                                                </span>
                                          </div>
                                    </div>
                                    {% if location_stock.discount %}
                                          {% include 'Components/PercentageOff.html' with percentage=location_stock.discount|floatformat:0 show_price='true' discounted_price=location_stock.final_price|floatformat:2 %}
                                    {% endif %}
                              </div>
                              <div class="!mt-5 flex items-center gap-1">
                                    {% if not location_stock.discount %}
                                          <p class="text-2xl text-[#05D57C] outfit-font font-semibold italic flex items-center gap-1">
                                                <span class="font-medium text-[#151E2C] text-sm">PKR</span>{{location_stock.final_price|floatformat:2}}
                                          </p>                          
                                    {% endif %}
                              </div>
                        </div>
                        <div class="my-4 w-full h-[1px] bg-[#CACBE6]"> </div>
                        <div class="flex items-center gap-3">
                              <div class="flex items-center rounded-lg bg-[#6C7793] w-[120px] h-[40px] p-[1.5px]">
                                    <button onclick="handleIncrementDecrement(false)" class="cursor-pointer text-white text-xl font-semibold flex-1 h-full flex items-center justify-center">-</button>
                                    <p class="text-[#0A1C4B] text-xl font-semibold rounded-md flex-1 h-full flex bg-white items-center justify-center outfit-font" ProductQuantity='1'>1</p>
                                    <button onclick="handleIncrementDecrement(true)" class="cursor-pointer text-white text-xl font-semibold flex-1 h-full flex items-center justify-center">+</button>
                                    <script>
                                          const handleIncrementDecrement = (is_add) => {
                                                let value_elemtn = document.querySelector('p[ProductQuantity]')
                                                if (!value_elemtn){
                                                      return
                                                }
                                                let value = value_elemtn.getAttribute('ProductQuantity')
                                                value = parseInt(value)
                                                
                                                if (is_add){
                                                      value += 1
                                                }
                                                else{
                                                      if (value == 1){
                                                            return
                                                      }
                                                      value -= 1
                                                }
                                                value_elemtn.innerHTML = value
                                                value_elemtn.setAttribute('ProductQuantity', value)
                                          }
                                    </script>
                              </div>
                              <button class="bg-gradient-to-r from-[#8F17F6] via-[#EB14E5] to-[#FC736D] rounded-full px-5 py-2.5 text-white text-sm outfit-font cursor-pointer" onclick="add_to_cart_btn()">
                                    Add to Cart
                              </button>
                        </div>
                  </div>
                  {% if other_locations|length > 0 %}
                        <div class="max-w-[370px] w-full space-y-3">
                              {% for location_product in other_locations %}
                                    <div class="flex rounded-lg relative cursor-default bg-white border border-[#CACBE6] transition-all gap-1 overflow-hidden">
                                          {% if location_product.discount %}
                                                <div class="absolute right-0 top-[26px]">
                                                      <span class="font-semibold text-[#151E2C] rounded-md rounded-r-none bg-[#f0da69] py-2 px-3 text-sm">{{location_product.discount|floatformat:0}}% OFF</span>
                                                </div>
                                          {% endif %}
                                          <div class="flex items-center justify-center h-20 w-20 bg-center bg-no-repeat bg-cover" style="background-image: url('{% if product.product_all_images.0.image %}{{product.product_all_images.0.image.url}}{% endif %}');">   </div>
                                          <div class="px-1 space-y-2 flex-1">
                                                {% comment %} <div class="text-[#FFFFFF] text-xs bg-[#F01275] max-w-max rounded-full px-2.5 py-[3px] line-clamp-1 outfit-font">{{product.store.name}}</div> {% endcomment %}
                                                <div class="">
                                                      <a class="cursor-pointer" href="{% url 'SingleMedicineViewPage' product.slug %}?selected_location={{location_product.location_id}}">
                                                            <h2 class="font-medium outfit-font text-[#151E2C] line-clamp-1">{{product.name}}</h2>
                                                      </a>
                                                      <span class="text-xs outfit-font text-[#0555E9] flex gap-1">
                                                            {{location_product.location_name}}
                                                            <span class="whitespace-nowrap text-[11px] outfit-font text-[#0555E9] flex items-center gap-1" showdistance="{{location_product.lat}},{{location_product.lng}}"></span>
                                                      </span>
                                                </div>
                                                <div class="flex items-center justify-between gap-2 !mt-4">
                                                      <div class="bg-gradient-to-r from-[#05DC75] to-[#0755E9] p-[1px] rounded-full">
                                                            <div class="rounded-full max-w-max px-4 py-2.5 text-sm outfit-font text-[#151E2C] bg-white cursor-pointer whitespace-nowrap">
                                                                  + Add to Cart
                                                            </div>
                                                      </div>
                                                      <div class="flex items-center gap-1">
                                                            {% if location_product.discount %}
                                                                  <span class="text-sm text-[#3C3C3C]/60"><del>{{location_product.price}}</del></span>
                                                            {% endif %}
                                                            <p class="text-lg text-[#05D57C] outfit-font font-semibold italic flex items-center gap-1">
                                                                  <span class="font-medium text-[#151E2C] text-xs">PKR</span>
                                                                  {{location_product.final_price|floatformat:2}}
                                                            </p>                          
                                                      </div>
                                                </div>
                                          </div>
                                    </div>
                              {% endfor %}
                        </div>
                  {% endif %}
            </div>
            <!-- after checkout popup -->
            <!-- <div class="w-[550px]">
                  <div class="rounded-[18px] bg-[#24D0D01A] items-center px-[15px] py-[50px] flex flex-col gap-1">
                        <h2 class="text-[#557DE5] text-[26px] font-semibold">Bringing Healing to Your Doorstep </h2>
                        <p class="text-[22px] font-medium text-[#24D0D0]">Fast, Reliable, and Convenient Medicine Delivery!</p>
                        <div class="mt-7">
                              {% include 'Components/SVG/Deliverd-Medicine-SVG.html' %}
                        </div>
                  </div>
            </div> -->
            <div class="w-[1150px]">
                  {% comment %} <div class="bg-[#24D0D01A] pl-[35px] py-[20px] flex gap-[50px]">
                        <li class="text-[18px] font-[700] text-[#24D0D0] list-none cursor-pointer">Product Description</li>
                        <li class="text-[18px] font-[700] text-[#8989B6] list-none cursor-pointer hover:text-[#24D0D0]">How to use</li>
                        <li class="text-[18px] font-[700] text-[#8989B6] list-none cursor-pointer hover:text-[#24D0D0]">Side Effects</li>
                        <li class="text-[18px] font-[700] text-[#8989B6] list-none cursor-pointer hover:text-[#24D0D0]">Pharmacy Details</li>
                        <li class="text-[18px] font-[700] text-[#8989B6] list-none cursor-pointer hover:text-[#24D0D0]">Reviews</li>
                  </div> {% endcomment %}
                  <div>
                        <h3 class="text-[18px] mt-[18px] font-semibold outfit-font">Description</h2>
                        <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.description %}{{product.description}}{% else %}---{% endif %}</p>
                  </div>
                  <div>
                        <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Key Highlights</h2>
                        <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.key_highlights %}{{product.key_highlights}}{% else %}---{% endif %}</p>
                  </div>
                  <div class='grid grid-cols-3'>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Manufacturer</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.manufacturer %}{{product.manufacturer}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Market By</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.marketed_by %}{{product.marketed_by}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Product Form</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.product_form %}{{product.product_form.name}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Product Type</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.product_type %}{{product.product_type.name}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Generic Category</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.generic_category %}{{product.generic_category}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Formulation</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.formulation %}{{product.formulation}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Strength</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.strength %}{{product.strength}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Pack Size</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.pack_size %}{{product.pack_size}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Pack Form</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.pack_form %}{{product.pack_form}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Storage</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.storage %}{{product.storage}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Habit Forming</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.habit_forming %}{{product.habit_forming}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Sedation</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.sedation %}{{product.sedation}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Child Safety</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.child_safety %}{{product.child_safety}}{% else %}---{% endif %}</p>
                        </div>
                        <div>
                              <h3 class="text-[18px] mt-[13px] font-semibold outfit-font">Route Of Administration</h2>
                              <p class="mt-[5px] text-gray-600 text-[16px] mr-[30px] outfit-font pl-2 capitalize">{% if product.route_of_administration %}{{product.route_of_administration}}{% else %}---{% endif %}</p>
                        </div>
                  </div>
                  {% comment %} <h2 class="text-[18px] mt-[15px] font-semibold text-[#323232]">Reviews</h2>
                  <div class="flex flex-col gap-[10px]">
                        {% include 'Components/Pharmacy/MedicineReview.html' %}
                  </div> {% endcomment %}
            </div>
            <div class="mt-[50px]">
                  {% include 'Components/Pharmacy/HomeMedicineSection.html' with medicines=medicines %}
            </div>
      </section>
</main>


<script defer src="{% static 'assets/swiper/main_swiper.js' %}"></script>
  <script>
      const authToken = '{{authToken}}'
      const productSlug = '{{product.slug}}'
      const location_stock = '{{location_stock.id}}'

    document.addEventListener('DOMContentLoaded', () => {
      function totalshowPM() {
        let section = document.querySelector(".change-location-popup-main-BG");
        if (section) {
          section.classList.add("change-location-popup-main-BG-after");
        }
      }
      var total = document.querySelector(".change-location-btn");
      if (total) {
        total.addEventListener("click", totalshowPM);
      }
    })
    // 
    document.addEventListener('DOMContentLoaded', () => {
      function totalshowPM1() {
        let section = document.querySelector(".change-location-popup-main-BG");
        if (section) {
          section.classList.remove("change-location-popup-main-BG-after");
        }
      }
      var total = document.querySelector(".cancle-location-popup");
      if (total) {
        total.addEventListener("click", totalshowPM1);
      }
    })

//     
// 
// 

document.addEventListener('DOMContentLoaded', () => {
      function totalshowPM() {
        let section = document.querySelector(".change-location-popup-main-BG");
        if (section) {
          section.classList.add("change-location-popup-main-BG-after");
        }
      }
      var total = document.querySelector(".morebtn-before-location");
      if (total) {
        total.addEventListener("click", totalshowPM);
      }
    })
    // 
    document.addEventListener('DOMContentLoaded', () => {
      function totalshowPM1() {
        let section = document.querySelector(".change-location-popup-main-BG");
        if (section) {
          section.classList.remove("change-location-popup-main-BG-after");
        }
      }
      var total = document.querySelector(".cancle-location-popup");
      if (total) {
        total.addEventListener("click", totalshowPM1);
      }
    })


    let cart__popup__main = document.getElementById('cart__popup__main');

    function add_to_cart_btn() {
      const ProductQuantity = document.querySelector('[ProductQuantity]').getAttribute('ProductQuantity');
      let CartItems = getCookie('CartItems');
      if (CartItems){
            CartItems = JSON.parse(CartItems)
      }
      else{
            CartItems = []
      }
      let already_exist = CartItems.find(item => item.slug == productSlug)
      if (already_exist){
            CartItems = CartItems.map(itm => ({...itm, quantity : itm.slug == productSlug ? parseInt(ProductQuantity) : parseInt(itm.quantity),}))
      }
      else{
            CartItems.push({'slug' : productSlug, 'quantity' : ProductQuantity, 'location_stock' : location_stock})
      }
      setCookie('CartItems', JSON.stringify(CartItems), 7)
      ShowNotification({type : 'success', message : 'Cart updated successfully'})
      setTimeout(() => {
            showSidebarCart()
      }, 1000);
    }

    

  </script>
{% endblock pharmacy_body %}